# Wizard System Flowchart

## High-Level Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                    OpenDESSEM Wizard System                     │
│                                                                  │
│  ┌────────────────┐              ┌──────────────────┐          │
│  │ User Interface │◄────────────►│ Wizard State     │          │
│  │ (Prompts)      │              │ (Config Dict)    │          │
│  └────────────────┘              └──────────────────┘          │
│                                          │                      │
│                                          ▼                      │
│  ┌────────────────┐              ┌──────────────────┐          │
│  │ Input          │─────────────►│ Validation       │          │
│  │ (readline)     │              │ (Range/Type)     │          │
│  └────────────────┘              └──────────────────┘          │
│                                          │                      │
│                                          ▼                      │
│  ┌────────────────┐              ┌──────────────────┐          │
│  │ Help System    │◄────────────►│ Error Messages   │          │
│  │ (show_help)    │              │ (Validation)     │          │
│  └────────────────┘              └──────────────────┘          │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

## Wizard Flow

```
                    ┌─────────────────────┐
                    │   START WIZARD      │
                    └──────────┬──────────┘
                               │
                               ▼
                    ┌─────────────────────┐
                    │   Choose Mode       │
                    │                     │
                    │ 1. Interactive      │
                    │ 2. Quick Start      │
                    │ 3. Exit             │
                    └──────────┬──────────┘
                               │
            ┌──────────────────┴──────────────────┐
            │                                     │
            ▼                                     ▼
   ┌─────────────────┐              ┌─────────────────┐
   │  Interactive    │              │  Quick Start    │
   │  Mode           │              │  Mode           │
   └────────┬────────┘              └────────┬────────┘
            │                                │
            │                                │
            ▼                                ▼
   ┌─────────────────┐              ┌─────────────────┐
   │  Step 1:        │              │  Use Defaults   │
   │  System Basics  │              │  for All Steps  │
   └────────┬────────┘              └────────┬────────┘
            │                                │
            ▼                                │
   ┌─────────────────┐                      │
   │  Step 2:        │                      │
   │  Define Buses   │                      │
   └────────┬────────┘                      │
            │                                │
            ▼                                │
   ┌─────────────────┐                      │
   │  Step 3:        │                      │
   │  Submarkets     │                      │
   └────────┬────────┘                      │
            │                                │
            ▼                                │
   ┌─────────────────┐                      │
   │  Step 4:        │                      │
   │  Thermal Plants │                      │
   └────────┬────────┘                      │
            │                                │
            ▼                                │
   ┌─────────────────┐                      │
   │  Step 5:        │                      │
   │  Hydro Plants   │                      │
   └────────┬────────┘                      │
            │                                │
            ▼                                │
   ┌─────────────────┐                      │
   │  Step 6:        │                      │
   │  Renewables     │                      │
   └────────┬────────┘                      │
            │                                │
            ▼                                │
   ┌─────────────────┐                      │
   │  Step 7:        │                      │
   │  Loads          │                      │
   └────────┬────────┘                      │
            │                                │
            ▼                                │
   ┌─────────────────┐                      │
   │  Step 8:        │                      │
   │  Interconnections│                     │
   └────────┬────────┘                      │
            │                                │
            ▼                                │
   ┌─────────────────┐                      │
   │  Step 9:        │                      │
   │  Solver Options │                      │
   └────────┬────────┘                      │
            │                                │
            └────────────────┬───────────────┘
                             │
                             ▼
                    ┌─────────────────────┐
                    │  Display Summary    │
                    └──────────┬──────────┘
                               │
                               ▼
                    ┌─────────────────────┐
                    │  Confirm & Proceed? │
                    └──────────┬──────────┘
                               │
              ┌────────────────┴────────────────┐
              │ Yes                             │ No
              ▼                                 ▼
     ┌─────────────────┐              ┌─────────────────┐
     │  Build System   │              │  Exit/Cancel    │
     └────────┬────────┘              └─────────────────┘
              │
              ▼
     ┌─────────────────┐
     │  Create Model   │
     └────────┬────────┘
              │
              ▼
     ┌─────────────────┐
     │  Add Variables  │
     └────────┬────────┘
              │
              ▼
     ┌─────────────────┐
     │  Build Constr.  │
     └────────┬────────┘
              │
              ▼
     ┌─────────────────┐
     │  Build Objective│
     └────────┬────────┘
              │
              ▼
     ┌─────────────────┐
     │  Solve (2-Stage)│
     └────────┬────────┘
              │
              ▼
     ┌─────────────────┐
     │  Display Results│
     └────────┬────────┘
              │
              ▼
     ┌─────────────────┐
     │  SUCCESS        │
     └─────────────────┘
```

## Step Detail: Define Thermal Plants

```
┌──────────────────────────────────────────────────────────────┐
│ STEP 4: DEFINE THERMAL PLANTS                                │
└──────────────────────────────────────────────────────────────┘
                            │
                            ▼
            ┌───────────────────────────┐
            │ Show Help (Optional)      │
            │ - Fuel types              │
            │ - Typical parameters      │
            │ - Cost ranges             │
            └──────────────┬────────────┘
                           │
                           ▼
            ┌───────────────────────────┐
            │ Prompt: Number of plants? │
            │ Default: 3                │
            │ Range: 0-50               │
            └──────────────┬────────────┘
                           │
                           ▼
            ┌───────────────────────────┐
            │ Validate Input            │
            │ - Must be integer         │
            │ - In range [0, 50]        │
            └──────────────┬────────────┘
                           │
              ┌────────────┴────────────┐
              │                         │
              ▼                         ▼
      ┌──────────────┐         ┌──────────────┐
      │ n = 0        │         │ n > 0        │
      │ (Skip)       │         │ (Create)     │
      └──────┬───────┘         └──────┬───────┘
             │                        │
             │                        ▼
             │            ┌───────────────────────────┐
             │            │ Prompt: Use defaults?     │
             │            │ Default: Yes              │
             │            └──────────────┬────────────┘
             │                           │
             │              ┌────────────┴────────────┐
             │              │ Yes                    │ No
             │              ▼                        ▼
             │    ┌───────────────────┐  ┌───────────────────┐
             │    │ Create with       │  │ Create with       │
             │    │ Defaults          │  │ Custom Params     │
             │    │                   │  │ (Future feature)  │
             │    └─────────┬─────────┘  └─────────┬─────────┘
             │              │                      │
             │              ▼                      │
             │    ┌───────────────────┐            │
             │    │ Diverse Mix:      │            │
             │    │ - Coal (500 MW)   │            │
             │    │ - Gas CC (300 MW) │            │
             │    │ - Gas Peaker      │            │
             │    └─────────┬─────────┘            │
             │              │                      │
             └──────────────┴──────────────────────┘
                           │
                           ▼
            ┌───────────────────────────┐
            │ Store in Wizard State     │
            │ config["thermal_plants"]  │
            └──────────────┬────────────┘
                           │
                           ▼
            ┌───────────────────────────┐
            │ ✓ Thermal plants configured│
            └───────────────────────────┘
```

## Input Validation Flow

```
┌──────────────────────┐
│  User Input         │
│  (readline)         │
└──────────┬───────────┘
           │
           ▼
┌──────────────────────┐
│  Is Empty?          │
└──────────┬───────────┘
           │
    ┌──────┴──────┐
    │ Yes        │ No
    ▼            ▼
┌─────────┐  ┌──────────────┐
│ Use     │  │ Validate     │
│ Default │  │ User Input   │
└────┬────┘  └──────┬───────┘
     │              │
     │              ▼
     │     ┌──────────────────┐
     │     │ Valid?           │
     │     └────────┬─────────┘
     │              │
     │     ┌────────┴────────┐
     │     │ No              │ Yes
     │     ▼                 ▼
     │  ┌─────────┐    ┌─────────────┐
     │  │ Show    │    │ Return      │
     │  │ Error   │    │ Value       │
     │  │ Retry   │    └──────┬──────┘
     │  └────┬────┘          │
     │       │               │
     └───────┴───────────────┘
             │
             ▼
     ┌─────────────────┐
     │ Next Prompt     │
     └─────────────────┘
```

## Entity Creation Pattern

```
┌────────────────────────────────────────────────────────────┐
│ ENTITY CREATION TEMPLATE                                   │
└────────────────────────────────────────────────────────────┘

For each entity type (buses, plants, loads, etc.):

┌────────────────────┐
│ Count n            │
└─────────┬──────────┘
          │
          ▼
┌────────────────────┐
│ n == 0?            │──── Yes ──► Skip (empty array)
└─────────┬──────────┘
          │ No
          ▼
┌────────────────────┐
│ n <= threshold?    │
│ (simple system)    │
└─────────┬──────────┘
          │
     ┌────┴────┐
     │ Yes     │ No
     ▼         ▼
┌─────────┐ ┌─────────┐
│ Use     │ │ Use     │
│ Simple  │ │ Complex │
│ Pattern │ │ Pattern │
└────┬────┘ └────┬────┘
     │          │
     ▼          ▼
┌────────────────────┐
│ Create Entities    │
│ - Loop 1 to n      │
│ - Assign IDs       │
│ - Set parameters   │
│ - Apply patterns   │
└─────────┬──────────┘
          │
          ▼
┌────────────────────┐
│ Validate Entities  │
│ - Check constraints│
│ - Verify refs      │
└─────────┬──────────┘
          │
          ▼
┌────────────────────┐
│ Store in config    │
└────────────────────┘
```

## Default Thermal Plant Creation

```
┌────────────────────────────────────────────────────────────┐
│ create_default_thermal_plants(n, bus_names, submarkets)   │
└────────────────────────────────────────────────────────────┘

Input: n=3, buses=["BUS_1", "BUS_2", "BUS_3"],
       subs=["N", "C", "S"]

                    │
                    ▼
        ┌───────────────────────┐
        │ For i = 1 to n        │
        └───────────┬───────────┘
                    │
        ┌───────────┴───────────┐
        │                       │
        ▼                       ▼
┌─────────────────┐   ┌─────────────────┐
│ Plant 1         │   │ Plant 2         │
│ - Bus: BUS_1    │   │ - Bus: BUS_2    │
│ - Sub: N        │   │ - Sub: C        │
│ - Fuel: COAL    │   │ - Fuel: GAS     │
│ - Cap: 500 MW   │   │ - Cap: 300 MW   │
│ - Cost: 80 R$/MWh│  │ - Cost: 120 R$/MWh│
│ - Role: Base    │   │ - Role: Mid     │
└─────────────────┘   └─────────────────┘

        ┌───────────────────────┐
        │ Plant 3               │
        │ - Bus: BUS_3          │
        │ - Sub: S              │
        │ - Fuel: GAS           │
        │ - Cap: 200 MW         │
        │ - Cost: 200 R$/MWh    │
        │ - Role: Peak          │
        └───────────────────────┘

Result: Array of 3 ConventionalThermal
```

## System Building Flow

```
┌────────────────────────────────────────────────────────────┐
│ build_system()                                             │
└────────────────────────────────────────────────────────────┘

                    │
                    ▼
        ┌───────────────────────┐
        │ Get entities from     │
        │ wizard.config         │
        └───────────┬───────────┘
                    │
                    ▼
        ┌───────────────────────┐
        │ Add forecasts to      │
        │ renewables            │
        │ - Wind: diurnal       │
        │ - Solar: bell curve   │
        └───────────┬───────────┘
                    │
                    ▼
        ┌───────────────────────┐
        │ Create                │
        │ ElectricitySystem(;)  │
        └───────────┬───────────┘
                    │
                    ▼
        ┌───────────────────────┐
        │ Validate System       │
        │ - Foreign keys        │
        │ - References          │
        └───────────┬───────────┘
                    │
                    ▼
        ┌───────────────────────┐
        │ Return System         │
        └───────────────────────┘
```

## Optimization Flow

```
┌────────────────────────────────────────────────────────────┐
│ run_optimization(system)                                  │
└────────────────────────────────────────────────────────────┘

                    │
                    ▼
        ┌───────────────────────┐
        │ Create JuMP Model()   │
        └───────────┬───────────┘
                    │
                    ▼
        ┌───────────────────────┐
        │ create_variables!()  │
        │ - Thermal: u, g, v, w │
        │ - Hydro: s, q, gh    │
        │ - Renewable: gr      │
        └───────────┬───────────┘
                    │
                    ▼
        ┌───────────────────────┐
        │ Build Constraints    │
        │ - Thermal UC         │
        │ - Hydro Water Bal.   │
        │ - Renewable Limits   │
        │ - Submarket Balance  │
        └───────────┬───────────┘
                    │
                    ▼
        ┌───────────────────────┐
        │ build_objective!()   │
        │ - Fuel costs         │
        │ - Startup costs      │
        │ - Shutdown costs     │
        └───────────┬───────────┘
                    │
                    ▼
        ┌───────────────────────┐
        │ compute_two_stage_   │
        │ lmps()                │
        │ - Stage 1: UC (MIP)  │
        │ - Stage 2: SCED (LP) │
        └───────────┬───────────┘
                    │
                    ▼
        ┌───────────────────────┐
        │ Return (uc_result,    │
        │         sced_result)  │
        └───────────────────────┘
```

## Data Flow Summary

```
┌─────────────┐
│   User      │
│   Input     │
└──────┬──────┘
       │
       ▼
┌─────────────┐     ┌──────────────┐
│   Wizard    │────►│  Validation  │
│   Prompts   │     │  Functions   │
└──────┬──────┘     └──────────────┘
       │
       ▼
┌─────────────┐
│  Wizard     │
│  State      │
│  (Dict)     │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  Entity     │
│  Creation   │
│  Functions  │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  Electrici- │
│  tySystem   │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  JuMP       │
│  Model      │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  Optimize   │
│  (HiGHS)    │
└──────┬──────┘
       │
       ▼
┌─────────────┐
│  Results    │
│  Display    │
└─────────────┘
```

## Error Handling

```
┌─────────────────────┐
│ Try: run_wizard()   │
└──────────┬──────────┘
           │
           ├─────────────────┐
           │                 │
           ▼                 ▼
    ┌──────────┐    ┌──────────────────┐
    │ Success  │    │ Error Caught     │
    └────┬─────┘    └─────┬────────────┘
         │                │
         ▼                ▼
    ┌──────────┐    ┌──────────────────┐
    │ Display  │    │ Show Error       │
    │ Results  │    │ Message          │
    └──────────┘    └──────────────────┘
```

## Future Enhancement: Save/Load

```
┌─────────────────────┐          ┌─────────────────────┐
│ Save to JSON        │          │ Load from JSON      │
└──────────┬──────────┘          └──────────┬──────────┘
           │                                 │
           ▼                                 ▼
┌─────────────────────┐          ┌─────────────────────┐
│ wizard.config       │          │ Read JSON File      │
│ ↓                   │          │ ↓                   │
│ JSON string         │          │ Parse to Dict       │
│ ↓                   │          │ ↓                   │
│ Write to file       │          │ wizard.config       │
└─────────────────────┘          └─────────────────────┘
```
